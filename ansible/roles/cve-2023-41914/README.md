# cve-2023-41914

This role fixes [Slurm CVE-2023-41914](https://lists.schedmd.com/pipermail/slurm-announce/2023/000100.html):

> A number of race conditions have been identified within the slurmd/slurmstepd processes that can lead to the user taking ownership of an arbitrary file on the system. A related issue can lead to the user overwriting an arbitrary file on the compute node (although with data that is not directly under their control). A related issue can also lead to the user deleting all files and sub-directories of an arbitrary target directory on the compute node.

**NB:** It is only suitable for use on systems installed from OpenHPC v2.6.1 (Slurm v22.05).

At the time of writing, new OpenHPC packages have been built but are not available from the respositories (reference), hence `dnf update ...` is not available.

This role can be run in two ways:

1. To remediate an existing system, run `tasks/main.yml`, e.g. using the playbook `ansible/adhoc/cve-2023-41914.yml`. This will:
- Stop all Slurm services
- Backup the slurmdbd mysql database to the volume-backed directory `/var/lib/state/mysql-backups/` on the control node (by default).
- Uninstall the affected packages and install updated rpms from the OpenHPC build system.
- Restart Slurm services.

    **NB**: This playbook will ALWAYS stop and restart Slurm, even if no updates are actually required.

2. To remediate images during build (i.e no Slurm services are running, no slurm database exists), run `tasks/install-rpms.yml`, e.g. using the following in an environment pre-hook:

```yaml
- hosts: builder
  gather_facts: no
  become: yes
  tasks:
    - name: Apply fixes for cve-2023-41914
      import_role:
        name: cve-2023-41914
        tasks_from: install-rpms.yml
```
